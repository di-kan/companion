<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <title>Gervoc</title>
      <script>
      window.addEventListener('DOMContentLoaded', function() {
        // Get the template form and its checkboxes
        var templateForms = document.getElementsByClassName('template-form');
        for (var i = 0 ; i < templateForms.length; i++) {
            var templateCheckboxes = templateForms[i].querySelectorAll('input[type="checkbox"]');
            // Attach click event listener to template checkboxes
            for (var j = 0; j < templateCheckboxes.length; j++) {
              templateCheckboxes[j].addEventListener('click', handleCheckboxClick);
          }
        }


        // Function to handle checkbox click event
        function handleCheckboxClick(event) {
          var templateForms = document.getElementsByClassName('template-form');
          //Iterate all template forms (1 form)
          for (var i = 0 ; i < templateForms.length; i++) {
            // query all checkboxes of the template form
            var templateCheckboxes = templateForms[i].querySelectorAll('input[type="checkbox"]');
            var template = Array(templateCheckboxes.length).fill(false)
            for (var k = 0; k < templateCheckboxes.length; k++) {
              template[k]= templateCheckboxes[k].checked
            }
          }

          // Update checkboxes in all other forms
          var forms = document.getElementsByClassName('word-form');
          // Iterate all word - forms
          for (var i = 0; i < forms.length; i++) {
            var form = forms[i];
            var checkboxes = form.querySelectorAll('input[type="checkbox"]');
             console.log(template)
            //iterate all checkboxes of a form
            for (var j = 0; j < checkboxes.length; j++) {
              checkboxes[j].checked = template[j%template.length];
            }
          }
        }
      });
     </script>
  </head>
  <body>
{% include "menu.html" %}


{% if words is defined %}
  <p class="h1">Assign tags to words</p>
  <hr>
    <form class="template-form" id="template-form">
    <div class="container">
    <div class="row">
    {% for tag in tags %}
      {% for key,values in tag.items() %}
      {% if key != "page" %}
        <div class="col">{{ key }}
        {% for val in values %}
          <div class="form-check">
          <input class="form-check-input" type="checkbox" value="" id="template-{{ key }}-{{ val }}">
          <label class="form-check-label" for="template-{{ key }}-{{ val }}">{{ val }}</label>
          </div>
        {% endfor %}
        </div>
      {% endif %}
      {% endfor %}
    {% endfor %}
    </div>
    </div>
    </form>
  <hr>
  <form class="word-form" action="/tagwords", method="POST">
  <div class="table-responsive-sm">
  <button type="submit" class="btn btn-primary">Submit All</button>

  <table class="table">
    <thead>
      <tr>
        <th scope="col" >#</th>
        <th scope="col" >Page</th>
        <th scope="col" >Word</th>
        <th scope="col" >Translation</th>
        <th scope="col" >Tags</th>
      </tr>
    </thead>
    <tbody>
    {# Iterate all words (list) #}
      {% for word in words %}
      <tr>
        <th scope="row">{{ index }}</th>
        <td>{{ word['page'] }}</td>
        <td>{{ word['word'] }}</td>
        <td>{{ word['translation'] }}</td>

        <td>
            <div class="container">
              <div class="row">
                {% for tag in tags %}
                  {% for key, values in tag.items() %}
                  {% if key != "page" %}
                  <div class="col">{{ key }}
                    {% for val in values %}
                      <div class="form-check">
{% set noun_m_indexes = word['tags']['keys'] | select('equalto', key) | list %}
                        {{ noun_m_indexes }}
{% set m_indexes = word['tags']['vals'] | select('equalto', val) | list %}
{% set common_indexes = [] %}
{% for index in noun_m_indexes %}
    {% if index in m_indexes %}
        {% set _ = common_indexes.append(index) %}
    {% endif %}
{% endfor %}
{% set result = common_indexes | length > 0 %}
{{ result }}










                        {{ word['tags']['keys'] | select('equalto', key) | list }}
                        <input class="form-check-input" type="checkbox" name="{{ key }}-{{ val }}" id="{{ key }}-{{ val }}">
                        <label class="form-check-label" for="{{ key }}-{{ val }}">{{ val }}</label>
                      </div>
                    {% endfor %}
                  </div>
                  {% endif %}
                  {% endfor %}
                {% endfor %}
              </div>
            </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  </div>
  </form>
  <hr>
{% else %}
  <p class="h1">Regex search words</p>
<form action="/tagwords" method="POST">
  <div class="mb-3">
    <input type="text" class="form-control" name="filter" id="filter" aria-describedby="Regex filter">
  </div>
  <div class="mb-3 form-check">
    <input type="checkbox" class="form-check-input" name="case-sensitive" id="case-sensitive">
    <label class="form-check-label" for="case-sensitive">Case sensitive</label>
  </div>
  <button type="submit" class="btn btn-primary">Submit</button>
</form>
{% endif %}

{% include "footer.html" %}
